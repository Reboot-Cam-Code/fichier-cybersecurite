#!/usr/bin/python

import requests
import signal
import sys
import argparse
from requests.auth import HTTPBasicAuth

p = argparse.ArgumentParser(description="Usage: ./camera.py -h <ip> -p <port>")
p.add_argument("-ip", "--ipaddress", dest="ipaddress", help="Enter an ipaddress")
p.add_argument("-p", "--port", dest="port", default="8081", help="Enter a port")

args = p.parse_args()

host = args.ipaddress
port = args.port

def signal_handler(signal, frame):
        print("\nCtrl+C pressed.. aborting...")
        sys.exit()

def main():
        try:
                d = "http://"+host+":"+port
                print("[*] Using: "+d)
                r = requests.get(d,timeout=5)
                if r.status_code == 401 and 'MOBOTIX' in r.headers['WWW-Authenticate']:
                        print("[*] Looks like Basic Auth and MOBOTIX realm")
                        try:
                                print("...trying default creds")
                                r1 = requests.get(d, auth=HTTPBasicAuth('admin', 'meinsm'))
                                if r1.status_code == 200:
                                        print("[*] Default credentials found")
                                else:
                                        print("[*] No joy: "+ str(r1.status_code))
                                        sys.exit()
                        except requests.ConnectionError as e:
                                print(e)
                                sys.exit()
                else:
                        print("[*] No Basic Auth")
                        sys.exit()
        except requests.ConnectionError as e:
                print("[*] Connection Error: "+str(e))
                sys.exit()

if __name__ == '__main__':
        signal.signal(signal.SIGINT, signal_handler)
        main()

